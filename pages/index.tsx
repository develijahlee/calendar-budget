// https://medium.com/@nitinpatel_20236/challenge-of-building-a-calendar-with-pure-javascript-a86f1303267d
import { useState } from 'react'
import type { NextPage } from 'next'
import Head from 'next/head'
import styles from '../styles/Home.module.scss'
import Day from '../components/day'

const Home: NextPage = () => {
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
  const weekDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
  const today = new Date()

  const [currentMonth, setCurrentMonth] = useState(today.getMonth())
  const [currentYear, setCurrentYear] = useState(today.getFullYear())
  const [monthlyTotal, setMonthTotal] = useState(0)

  // check how many days in a month code from https://dzone.com/articles/determining-number-days-month
  const daysInMonth = (iMonth: number, iYear: number) => {
    return 32 - new Date(iYear, iMonth, 32).getDate()
  }

  // mark each day https://stackoverflow.com/questions/72065399/why-does-my-date-variable-reset-in-my-map/
  const calculateDay = (rowIndex: number, columnIndex: number, offset: number) => {
    return 7 * rowIndex + columnIndex + 1 - offset
  }

  const checkCurrentDay = (date: number) => {
    if (date === today.getDate() && currentYear === today.getFullYear() && currentMonth === today.getMonth()) {
      return true
    } else {
      return false
    }
  }

  const next = () => {
    setCurrentYear((currentMonth === 11) ? currentYear => currentYear + 1 : currentYear)
    setCurrentMonth((currentMonth + 1) % 12)
  }

  const previous = () => {
    setCurrentYear((currentMonth === 0) ? currentYear => currentYear - 1 : currentYear)
    setCurrentMonth((currentMonth === 0) ? 11 : currentMonth => currentMonth - 1)
  }

  const renderCalendar = () => {
    const totalDays = daysInMonth(currentMonth, currentYear)
    const firstDayInMonth = new Date(currentYear, currentMonth).getDay()
    const totalWeeks = Math.ceil((firstDayInMonth + totalDays) / 7)

    return (
      <>
        {[...Array(totalWeeks)].map((_, rowIndex) => (
          <div key={rowIndex} className={styles.row}>
            {weekDays.map((_, columnIndex) => {
              const calculatedDay = calculateDay(rowIndex, columnIndex, firstDayInMonth)
              return (
                <Day key={rowIndex + columnIndex} columnIndex={columnIndex} rowIndex={rowIndex} firstDayInMonth={firstDayInMonth} calculatedDay={calculatedDay} totalDays={totalDays} checkCurrentDay={checkCurrentDay} />
              )
            })}
          </div>
        ))}
      </>
    )
  }


  return (
    <div className={styles.container}>
      <Head>
        <title>Calendar Budget App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className={styles.buttonWrap}>
        <button onClick={previous}>Previous</button>
        <button onClick={next}>Next</button>
      </div>
      <div className={styles.calendarWrap}>
        <h2 className={styles.monthTitle}>{months[currentMonth]} {currentYear}</h2>
        <h3 className={styles.monthlyTotal}>Monthly Total Spent: {monthlyTotal}</h3>
        <div className={styles.daysWrap}>
          {weekDays.map((day) => (
            <span key={day}>{day}</span>
          ))}
        </div>
        <div className={styles.calendarBody}>
          {renderCalendar()}
        </div>
      </div>
    </div>
  )
}

export default Home
